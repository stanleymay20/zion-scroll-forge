generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Approval {
  id                String        @id @default(uuid())
  phase_progress_id String
  approver_id       String
  approver_name     String
  approver_role     String
  approved          Boolean
  comments          String?
  approved_at       DateTime      @default(now())
  PhaseProgress     PhaseProgress @relation(fields: [phase_progress_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Assessment {
  id                  String                @id
  course_module_id    String
  type                AssessmentType
  title               String
  description         String
  points              Int
  due_date            DateTime
  aligned_objectives  String[]
  created_at          DateTime              @default(now())
  updated_at          DateTime
  CourseModule        CourseModule          @relation(fields: [course_module_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  ProjectRequirements ProjectRequirements[]
  Question            Question[]
  Rubric              Rubric[]

  @@index([course_module_id], map: "idx_assessment_module")
}

model AssessmentQualityReport {
  id                String        @id
  quality_review_id String
  rigor_level       Float
  alignment         Float
  fairness          Float
  clarity           Float
  issues            String[]
  recommendations   String[]
  QualityReview     QualityReview @relation(fields: [quality_review_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model BiblicalFoundation {
  id                          String               @id
  spiritual_integration_id    String
  theological_themes          String[]
  christ_centered_perspective String
  SpiritualIntegration        SpiritualIntegration @relation(fields: [spiritual_integration_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Scripture                   Scripture[]
}

model Budget {
  id                String           @id
  course_project_id String
  total_allocated   Float
  remaining_funds   Float
  created_at        DateTime         @default(now())
  updated_at        DateTime
  CourseProject     CourseProject    @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  BudgetCategory    BudgetCategory[]
  Expense           Expense[]
}

model BudgetCategory {
  id        String @id
  budget_id String
  name      String
  allocated Float
  spent     Float  @default(0)
  remaining Float
  Budget    Budget @relation(fields: [budget_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Caption {
  id         String  @id
  lecture_id String
  language   String
  url        String
  format     String
  Lecture    Lecture @relation(fields: [lecture_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Change {
  id                  String    @id
  iteration_id        String
  type                String
  description         String
  affected_components String[]
  implemented_by      String
  implemented_at      DateTime  @default(now())
  Iteration           Iteration @relation(fields: [iteration_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ChecklistResult {
  id                String        @id
  quality_review_id String
  criterion         String
  passed            Boolean
  score             Float
  notes             String?
  QualityReview     QualityReview @relation(fields: [quality_review_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Competency {
  id                    String            @id
  deployment_pathway_id String
  name                  String
  description           String
  level                 String
  assessment_method     String
  DeploymentPathway     DeploymentPathway @relation(fields: [deployment_pathway_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ContentQualityReport {
  id                  String        @id
  quality_review_id   String
  accuracy            Float
  clarity             Float
  depth               Float
  scholarly_standards Float
  issues              String[]
  recommendations     String[]
  QualityReview       QualityReview @relation(fields: [quality_review_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model CourseFeedback {
  id                   String        @id
  outcome_data_id      String
  course_project_id    String
  strengths            String[]
  improvements         String[]
  real_world_relevance Float
  preparation_quality  Float
  CourseProject        CourseProject @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  OutcomeData          OutcomeData   @relation(fields: [outcome_data_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model CourseModule {
  id                   String                 @id @default(uuid())
  course_project_id    String
  courseId             String?
  week_number          Int
  title                String
  status               ModuleStatus           @default(DRAFT)
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  Assessment           Assessment[]
  CourseProject        CourseProject          @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  LearningObjective    LearningObjective[]
  Lecture              Lecture[]
  Material             Material[]
  SpiritualIntegration SpiritualIntegration[]

  @@index([course_project_id], map: "idx_course_module_course")
}

model CourseProject {
  id                String           @id @default(uuid())
  title             String
  code              String           @unique
  description       String
  credits           Int
  level             CourseLevel
  prerequisites     String[]
  currentPhase      Phase            @default(PLANNING) @map("current_phase")
  status            ProjectStatus    @default(ACTIVE)
  targetLaunchDate  DateTime?        @map("target_launch_date")
  actualLaunchDate  DateTime?        @map("actual_launch_date")
  completedAt       DateTime?        @map("completed_at")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  Budget             Budget[]
  CourseFeedback     CourseFeedback[]
  CourseModule       CourseModule[]
  PhaseProgress      PhaseProgress[]
  PilotProgram       PilotProgram[]
  PortfolioAsset     PortfolioAsset[]
  QualityReview      QualityReview[]
  TeamMember         TeamMember[]
  Timeline           Timeline[]

  @@index([code], map: "idx_course_project_code")
  @@index([status], map: "idx_course_project_status")
}

model Deliverable {
  id                String        @id @default(uuid())
  phase_progress_id String
  name              String
  description       String
  due_date          DateTime
  completed_date    DateTime?
  status            String
  assigned_to       String
  required          Boolean       @default(true)
  completed         Boolean       @default(false)
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  PhaseProgress     PhaseProgress @relation(fields: [phase_progress_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model DeploymentPathway {
  id                     String         @id
  module_id              String
  concept_id             String
  description            String
  real_world_application String
  systems_to_transform   String[]
  created_at             DateTime       @default(now())
  updated_at             DateTime
  Competency             Competency[]
  ImpactMetric           ImpactMetric[]

  @@index([module_id], map: "idx_deployment_pathway_module")
}

model Evidence {
  id                 String         @id
  portfolio_asset_id String
  type               String
  url                String
  description        String
  date               DateTime
  PortfolioAsset     PortfolioAsset @relation(fields: [portfolio_asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Example {
  id               String       @id
  lecture_notes_id String
  title            String
  description      String
  code             String?
  explanation      String
  LectureNotes     LectureNotes @relation(fields: [lecture_notes_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Expense {
  id          String   @id
  budget_id   String
  category    String
  amount      Float
  description String
  date        DateTime @default(now())
  approved_by String
  Budget      Budget   @relation(fields: [budget_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Gap {
  id                  String          @id
  readiness_report_id String
  area                String
  description         String
  severity            String
  remediation         String
  ReadinessReport     ReadinessReport @relation(fields: [readiness_report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ImpactMetric {
  id                      String               @id
  project_requirements_id String?
  deployment_pathway_id   String?
  outcome_data_id         String?
  name                    String
  description             String
  measurement_method      String
  target_value            String
  DeploymentPathway       DeploymentPathway?   @relation(fields: [deployment_pathway_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  OutcomeData             OutcomeData?         @relation(fields: [outcome_data_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  ProjectRequirements     ProjectRequirements? @relation(fields: [project_requirements_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Issue {
  id                 String         @id
  module_feedback_id String
  description        String
  severity           String
  category           String
  reported_by        String
  reported_at        DateTime       @default(now())
  ModuleFeedback     ModuleFeedback @relation(fields: [module_feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Iteration {
  id               String       @id
  pilot_program_id String
  description      String
  priority         Priority
  completed_at     DateTime?
  created_at       DateTime     @default(now())
  Change           Change[]
  PilotProgram     PilotProgram @relation(fields: [pilot_program_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model LearningObjective {
  id                 String       @id
  course_module_id   String
  description        String
  bloom_level        String
  assessment_methods String[]
  CourseModule       CourseModule @relation(fields: [course_module_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Lecture {
  id               String         @id
  course_module_id String
  title            String
  duration         Int
  transcript       String?
  created_at       DateTime       @default(now())
  updated_at       DateTime
  Caption          Caption[]
  CourseModule     CourseModule   @relation(fields: [course_module_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  LectureNotes     LectureNotes[]
  Resource         Resource[]
  VideoAsset       VideoAsset[]

  @@index([course_module_id], map: "idx_lecture_module")
}

model LectureNotes {
  id              String            @id
  lecture_id      String
  content         String
  summary         String
  key_concepts    String[]
  pdf_url         String
  page_count      Int
  created_at      DateTime          @default(now())
  updated_at      DateTime
  Example         Example[]
  Lecture         Lecture           @relation(fields: [lecture_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  PracticeProblem PracticeProblem[]
}

model Material {
  id               String       @id
  course_module_id String
  type             String
  title            String
  description      String
  url              String
  file_size        BigInt?
  format           String?
  created_at       DateTime     @default(now())
  CourseModule     CourseModule @relation(fields: [course_module_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Milestone {
  id             String    @id @default(uuid())
  timeline_id    String
  name           String
  description    String
  phase          Phase
  due_date       DateTime
  completed_date DateTime?
  completed      Boolean   @default(false)
  dependencies   String[]
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  Timeline       Timeline  @relation(fields: [timeline_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ModuleFeedback {
  id               String       @id
  pilot_program_id String
  module_id        String
  student_id       String
  comments         String
  submitted_at     DateTime     @default(now())
  Issue            Issue[]
  PilotProgram     PilotProgram @relation(fields: [pilot_program_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Rating           Rating[]
}

model Outcome {
  id                    String            @id
  project_connection_id String
  description           String
  measurement_method    String
  target_date           DateTime
  achieved              Boolean           @default(false)
  evidence              String?
  ProjectConnection     ProjectConnection @relation(fields: [project_connection_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model OutcomeData {
  id                  String           @id
  graduate_id         String
  deployment_id       String
  systems_transformed String[]
  collected_at        DateTime         @default(now())
  CourseFeedback      CourseFeedback[]
  ImpactMetric        ImpactMetric[]
  Testimony           Testimony[]
}

model PhaseProgress {
  id                String        @id @default(uuid())
  course_project_id String
  phase             Phase
  status            PhaseStatus   @default(NOT_STARTED)
  start_date        DateTime?
  completion_date   DateTime?
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  Approval          Approval[]
  Deliverable       Deliverable[]
  CourseProject     CourseProject @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([course_project_id], map: "idx_phase_progress_course")
  @@index([phase], map: "idx_phase_progress_phase")
}

model PilotProgram {
  id                String           @id
  course_project_id String
  start_date        DateTime
  end_date          DateTime
  launch_approved   Boolean          @default(false)
  created_at        DateTime         @default(now())
  updated_at        DateTime
  Iteration         Iteration[]
  ModuleFeedback    ModuleFeedback[]
  CourseProject     CourseProject    @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  PilotStudent      PilotStudent[]

  @@index([course_project_id], map: "idx_pilot_program_course")
}

model PilotStudent {
  id                String       @id
  pilot_program_id  String
  user_id           String
  name              String
  email             String
  enrolled_date     DateTime     @default(now())
  completion_status String
  PilotProgram      PilotProgram @relation(fields: [pilot_program_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model PortfolioAsset {
  id                  String             @id
  student_id          String
  course_project_id   String
  project_title       String
  description         String
  real_world_impact   String
  verification_status VerificationStatus @default(PENDING)
  created_at          DateTime           @default(now())
  updated_at          DateTime
  Evidence            Evidence[]
  CourseProject       CourseProject      @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([course_project_id], map: "idx_portfolio_asset_course")
  @@index([student_id], map: "idx_portfolio_asset_student")
}

model PracticeProblem {
  id               String       @id
  lecture_notes_id String
  question         String
  solution         String
  difficulty       String
  hints            String[]
  LectureNotes     LectureNotes @relation(fields: [lecture_notes_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ProjectConnection {
  id           String     @id
  student_id   String
  project_id   String
  organization String
  system_type  SystemType
  start_date   DateTime
  mentor_id    String?
  created_at   DateTime   @default(now())
  Outcome      Outcome[]
}

model ProjectRequirements {
  id                     String         @id
  assessment_id          String
  description            String
  deliverables           String[]
  real_world_application String
  timeline               String
  resources              String[]
  ImpactMetric           ImpactMetric[]
  Assessment             Assessment     @relation(fields: [assessment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model QualityReview {
  id                      String                    @id
  course_project_id       String
  reviewer_id             String
  review_date             DateTime                  @default(now())
  overall_score           Float
  approved                Boolean
  feedback                String
  recommendations         String[]
  created_at              DateTime                  @default(now())
  AssessmentQualityReport AssessmentQualityReport[]
  ChecklistResult         ChecklistResult[]
  ContentQualityReport    ContentQualityReport[]
  CourseProject           CourseProject             @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  VideoQualityReport      VideoQualityReport[]

  @@index([course_project_id], map: "idx_quality_review_course")
}

model Question {
  id             String     @id
  assessment_id  String
  type           String
  text           String
  options        String[]
  correct_answer String?
  explanation    String?
  points         Int
  Assessment     Assessment @relation(fields: [assessment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Rating {
  id                 String         @id
  module_feedback_id String
  category           String
  score              Int
  max_score          Int
  ModuleFeedback     ModuleFeedback @relation(fields: [module_feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ReadinessReport {
  id                   String   @id
  student_id           String
  assessment_id        String
  knowledge_score      Float
  skill_score          Float
  deployment_readiness Float
  recommendations      String[]
  created_at           DateTime @default(now())
  Gap                  Gap[]
}

model ReflectionQuestion {
  id                       String               @id
  spiritual_integration_id String
  question                 String
  purpose                  String
  guiding_thoughts         String[]
  SpiritualIntegration     SpiritualIntegration @relation(fields: [spiritual_integration_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Resource {
  id          String  @id
  lecture_id  String
  title       String
  type        String
  url         String
  description String
  citation    String?
  Lecture     Lecture @relation(fields: [lecture_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Rubric {
  id              String            @id
  assessment_id   String
  total_points    Int
  created_at      DateTime          @default(now())
  Assessment      Assessment        @relation(fields: [assessment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  RubricCriterion RubricCriterion[]
}

model RubricCriterion {
  id          String        @id
  rubric_id   String
  name        String
  description String
  weight      Float
  Rubric      Rubric        @relation(fields: [rubric_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  RubricLevel RubricLevel[]
}

model RubricLevel {
  id                  String          @id
  rubric_criterion_id String
  name                String
  description         String
  points              Int
  RubricCriterion     RubricCriterion @relation(fields: [rubric_criterion_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Scripture {
  id                     String             @id
  biblical_foundation_id String
  reference              String
  text                   String
  application            String
  BiblicalFoundation     BiblicalFoundation @relation(fields: [biblical_foundation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model SpiritualIntegration {
  id                    String               @id
  course_module_id      String
  worldview_perspective String
  prayer_points         String[]
  character_development String[]
  created_at            DateTime             @default(now())
  updated_at            DateTime
  BiblicalFoundation    BiblicalFoundation[]
  ReflectionQuestion    ReflectionQuestion[]
  CourseModule          CourseModule         @relation(fields: [course_module_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model StreamingUrl {
  id             String     @id
  video_asset_id String
  quality        String
  url            String
  bitrate        Int
  VideoAsset     VideoAsset @relation(fields: [video_asset_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model TeamMember {
  id                String        @id
  course_project_id String
  user_id           String
  name              String
  role              String
  responsibilities  String[]
  assigned_date     DateTime      @default(now())
  CourseProject     CourseProject @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Testimony {
  id              String      @id
  outcome_data_id String
  text            String
  author          String
  date            DateTime
  verified        Boolean     @default(false)
  OutcomeData     OutcomeData @relation(fields: [outcome_data_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Timeline {
  id                 String        @id @default(uuid())
  course_project_id  String        @unique
  start_date         DateTime
  target_launch_date DateTime
  estimated_end_date DateTime?
  actual_launch_date DateTime?
  created_at         DateTime      @default(now())
  updated_at         DateTime      @updatedAt
  Milestone          Milestone[]
  CourseProject      CourseProject @relation(fields: [course_project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model VideoAsset {
  id           String         @id @default(uuid())
  lecture_id   String
  courseId     String?
  url          String
  resolution   String
  format       String
  thumbnails   String[]
  duration     Int
  file_size    BigInt
  processed    Boolean        @default(false)
  created_at   DateTime       @default(now())
  StreamingUrl StreamingUrl[]
  Lecture      Lecture        @relation(fields: [lecture_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model VideoQualityReport {
  id                String        @id
  quality_review_id String
  audio_quality     Float
  visual_clarity    Float
  engagement        Float
  technical_issues  String[]
  recommendations   String[]
  QualityReview     QualityReview @relation(fields: [quality_review_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

enum AssessmentType {
  QUIZ
  ESSAY
  PROJECT
  ORAL_DEFENSE
  PEER_REVIEW
  FORMATIVE
  SUMMATIVE
  REFLECTIVE
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  STRATEGIC
}

enum Discipline {
  THEOLOGY
  COMPUTER_SCIENCE
  BUSINESS
  ENGINEERING
  EDUCATION
  HEALTHCARE
  LAW
  ARTS
}

enum ErrorSeverity {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum ModuleStatus {
  DRAFT
  IN_REVIEW
  APPROVED
  PUBLISHED
}

enum Phase {
  PLANNING
  CONTENT_DEVELOPMENT
  PRODUCTION
  QUALITY_REVIEW
  PILOT_TESTING
  LAUNCH
}

enum PhaseStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  BLOCKED
}

enum ProjectStatus {
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum SystemType {
  GOVERNMENT
  BUSINESS
  EDUCATION
  HEALTHCARE
  NONPROFIT
  CHURCH
  COMMUNITY
}



enum RigorLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  STRATEGIC
}

enum StrictnessProfile {
  STRICT_SPIRITUAL
  BALANCED
  LIGHT_CHECK
}

enum ErrorType {
  THEOLOGICAL_DRIFT
  TONE_PROBLEM
  SPIRITUALIZATION_OF_LAZINESS
  BABYLONIAN_FLATTENING
}

enum ProgressionLevel {
  AWARENESS_VOCABULARY
  UNDERSTANDING_ANALYSIS
  APPLICATION_PROBLEM_SOLVING
  SYSTEM_DESIGN_GOVERNANCE
  MULTIPLICATION_TEACHING
}

// ScrollLibrary Models

model ScrollBook {
  id                String              @id @default(uuid())
  title             String
  subtitle          String?
  subject           String
  level             AcademicLevel
  courseReference   String?             @map("course_reference")
  integrityHash     String              @map("integrity_hash")
  publishedAt       DateTime?           @map("published_at")
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  
  // Relationships
  chapters          ScrollChapter[]
  diagrams          ScrollDiagram[]
  metadata          ScrollBookMetadata?
  courseMaterials   ScrollCourseMaterial[]
  searchResults     ScrollSearchResult[]
  readingSessions   ScrollReadingSession[]
  exports           ScrollExportRequest[]

  @@index([subject], map: "idx_scroll_book_subject")
  @@index([level], map: "idx_scroll_book_level")
  @@index([courseReference], map: "idx_scroll_book_course_ref")
}

model ScrollBookMetadata {
  id                    String    @id @default(uuid())
  bookId                String    @unique @map("book_id")
  authorAgent           String    @map("author_agent")
  version               String
  scrollIntegrityHash   String    @map("scroll_integrity_hash")
  generationDate        DateTime  @map("generation_date")
  lastValidated         DateTime  @map("last_validated")
  qualityScore          Float     @map("quality_score")
  theologicalAlignment  Float     @map("theological_alignment")
  
  // Relationships
  book                  ScrollBook @relation(fields: [bookId], references: [id], onDelete: Cascade)
}

model ScrollChapter {
  id            String              @id @default(uuid())
  bookId        String              @map("book_id")
  title         String
  orderIndex    Int                 @map("order_index")
  content       String              // Markdown format
  readingTime   Int                 @map("reading_time") // minutes
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  
  // Relationships
  book          ScrollBook          @relation(fields: [bookId], references: [id], onDelete: Cascade)
  diagrams      ScrollDiagram[]
  references    ScrollReference[]
  summaries     ScrollSummary[]
  exercises     ScrollExercise[]
  knowledgeNodes ScrollKnowledgeNode[]
  audioNarrations ScrollAudioNarration[]
  annotations   ScrollAnnotation[]
  
  @@index([bookId], map: "idx_scroll_chapter_book")
  @@index([orderIndex], map: "idx_scroll_chapter_order")
}

model ScrollDiagram {
  id        String      @id @default(uuid())
  bookId    String?     @map("book_id")
  chapterId String?     @map("chapter_id")
  type      DiagramType
  content   String      // JSON or Mermaid syntax
  caption   String
  createdAt DateTime    @default(now()) @map("created_at")
  
  // Relationships
  book      ScrollBook?    @relation(fields: [bookId], references: [id], onDelete: Cascade)
  chapter   ScrollChapter? @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  studyPacks ScrollStudyPack[]
}

model ScrollReference {
  id        String        @id @default(uuid())
  chapterId String        @map("chapter_id")
  type      ReferenceType
  citation  String
  url       String?
  createdAt DateTime      @default(now()) @map("created_at")
  
  // Relationships
  chapter   ScrollChapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model ScrollSummary {
  id        String        @id @default(uuid())
  chapterId String        @map("chapter_id")
  type      SummaryType
  content   String
  createdAt DateTime      @default(now()) @map("created_at")
  
  // Relationships
  chapter   ScrollChapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model ScrollExercise {
  id        String        @id @default(uuid())
  chapterId String        @map("chapter_id")
  type      ExerciseType
  content   String
  solution  String?
  createdAt DateTime      @default(now()) @map("created_at")
  
  // Relationships
  chapter   ScrollChapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model ScrollCourseMaterial {
  id            String              @id @default(uuid())
  courseId      String              @map("course_id")
  textbookId    String?             @map("textbook_id")
  workbookId    String?             @map("workbook_id")
  lectureSlides String[]            @map("lecture_slides")
  studyPackId   String?             @map("study_pack_id")
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  
  // Relationships
  textbook      ScrollBook?         @relation(fields: [textbookId], references: [id])
  studyPack     ScrollStudyPack?    @relation(fields: [studyPackId], references: [id])
  pastQuestions ScrollQuestion[]
  pastQuestionsNew ScrollPastQuestion[]
  readingList   ScrollReadingListItem[]
  studentAccess ScrollStudentMaterialAccess[]
  versions      ScrollMaterialVersion[]
  
  @@index([courseId], map: "idx_scroll_course_material_course")
}

model ScrollKnowledgeNode {
  id            String                    @id @default(uuid())
  chapterId     String?                   @map("chapter_id")
  concept       String
  definition    String
  embeddings    Float[]                   // Vector representation
  relatedBooks  String[]                  @map("related_books")
  relatedChapters String[]                @map("related_chapters")
  createdAt     DateTime                  @default(now()) @map("created_at")
  updatedAt     DateTime                  @updatedAt @map("updated_at")
  
  // Relationships
  chapter       ScrollChapter?            @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  relationships ScrollRelationship[]      @relation("SourceNode")
  targetRelationships ScrollRelationship[] @relation("TargetNode")
  sources       ScrollSource[]
  
  @@index([concept], map: "idx_scroll_knowledge_node_concept")
}

model ScrollRelationship {
  id            String              @id @default(uuid())
  sourceNodeId  String              @map("source_node_id")
  targetNodeId  String              @map("target_node_id")
  type          RelationType
  strength      Float               // 0-1
  createdAt     DateTime            @default(now()) @map("created_at")
  
  // Relationships
  sourceNode    ScrollKnowledgeNode @relation("SourceNode", fields: [sourceNodeId], references: [id], onDelete: Cascade)
  targetNode    ScrollKnowledgeNode @relation("TargetNode", fields: [targetNodeId], references: [id], onDelete: Cascade)
  
  @@unique([sourceNodeId, targetNodeId, type])
}

model ScrollSource {
  id                String              @id @default(uuid())
  knowledgeNodeId   String              @map("knowledge_node_id")
  title             String
  author            String
  type              SourceType
  url               String?
  credibilityScore  Float               @map("credibility_score")
  createdAt         DateTime            @default(now()) @map("created_at")
  
  // Relationships
  knowledgeNode     ScrollKnowledgeNode @relation(fields: [knowledgeNodeId], references: [id], onDelete: Cascade)
}

model ScrollStudyPack {
  id              String                @id @default(uuid())
  courseId        String                @map("course_id")
  summaryBooklet  String                @map("summary_booklet") // PDF URL
  createdAt       DateTime              @default(now()) @map("created_at")
  
  // Relationships
  courseMaterials ScrollCourseMaterial[]
  practiceQuestions ScrollQuestion[]
  flashcards      ScrollFlashcard[]
  diagrams        ScrollDiagram[]
  cheatSheets     ScrollCheatSheet[]
  quizzes         ScrollQuiz[]
  
  @@index([courseId], map: "idx_scroll_study_pack_course")
}

model ScrollQuestion {
  id                String                @id @default(uuid())
  courseMaterialId  String?               @map("course_material_id")
  studyPackId       String?               @map("study_pack_id")
  quizId            String?               @map("quiz_id")
  type              QuestionType
  content           String
  options           String[]
  correctAnswer     String?               @map("correct_answer")
  explanation       String?
  createdAt         DateTime              @default(now()) @map("created_at")
  
  // Relationships
  courseMaterial    ScrollCourseMaterial? @relation(fields: [courseMaterialId], references: [id], onDelete: Cascade)
  studyPack         ScrollStudyPack?      @relation(fields: [studyPackId], references: [id], onDelete: Cascade)
  quiz              ScrollQuiz?           @relation(fields: [quizId], references: [id], onDelete: Cascade)
}

model ScrollFlashcard {
  id          String          @id @default(uuid())
  studyPackId String          @map("study_pack_id")
  front       String
  back        String
  category    String
  createdAt   DateTime        @default(now()) @map("created_at")
  
  // Relationships
  studyPack   ScrollStudyPack @relation(fields: [studyPackId], references: [id], onDelete: Cascade)
}

model ScrollCheatSheet {
  id          String          @id @default(uuid())
  studyPackId String          @map("study_pack_id")
  title       String
  content     String
  category    String
  createdAt   DateTime        @default(now()) @map("created_at")
  
  // Relationships
  studyPack   ScrollStudyPack @relation(fields: [studyPackId], references: [id], onDelete: Cascade)
}

model ScrollQuiz {
  id          String            @id @default(uuid())
  studyPackId String            @map("study_pack_id")
  title       String
  timeLimit   Int?              @map("time_limit") // minutes
  createdAt   DateTime          @default(now()) @map("created_at")
  
  // Relationships
  studyPack   ScrollStudyPack   @relation(fields: [studyPackId], references: [id], onDelete: Cascade)
  questions   ScrollQuestion[]
}

model ScrollReadingListItem {
  id                String                @id @default(uuid())
  courseMaterialId  String                @map("course_material_id")
  title             String
  author            String
  type              ReadingItemType
  url               String?
  required          Boolean
  createdAt         DateTime              @default(now()) @map("created_at")
  
  // Relationships
  courseMaterial    ScrollCourseMaterial  @relation(fields: [courseMaterialId], references: [id], onDelete: Cascade)
}

model ScrollSearchQuery {
  id        String              @id @default(uuid())
  userId    String              @map("user_id")
  query     String
  type      SearchType
  filters   Json?               // SearchFilters as JSON
  limit     Int?
  createdAt DateTime            @default(now()) @map("created_at")
  
  // Relationships
  results   ScrollSearchResult[]
  
  @@index([userId], map: "idx_scroll_search_query_user")
  @@index([type], map: "idx_scroll_search_query_type")
}

model ScrollSearchResult {
  id                  String            @id @default(uuid())
  searchQueryId       String            @map("search_query_id")
  bookId              String            @map("book_id")
  chapterId           String?           @map("chapter_id")
  title               String
  excerpt             String
  relevanceScore      Float             @map("relevance_score")
  propheticRelevance  Float?            @map("prophetic_relevance")
  conceptConnections  String[]          @map("concept_connections")
  createdAt           DateTime          @default(now()) @map("created_at")
  
  // Relationships
  searchQuery         ScrollSearchQuery @relation(fields: [searchQueryId], references: [id], onDelete: Cascade)
  book                ScrollBook        @relation(fields: [bookId], references: [id], onDelete: Cascade)
  
  @@index([searchQueryId], map: "idx_scroll_search_result_query")
  @@index([relevanceScore], map: "idx_scroll_search_result_relevance")
}

model ScrollReadingSession {
  id              String              @id @default(uuid())
  userId          String              @map("user_id")
  bookId          String              @map("book_id")
  chapterId       String?             @map("chapter_id")
  scrollPosition  Int                 @map("scroll_position")
  percentage      Float
  startedAt       DateTime            @default(now()) @map("started_at")
  lastAccessedAt  DateTime            @updatedAt @map("last_accessed_at")
  
  // Relationships
  book            ScrollBook          @relation(fields: [bookId], references: [id], onDelete: Cascade)
  annotations     ScrollAnnotation[]
  bookmarks       ScrollBookmark[]
  
  @@index([userId], map: "idx_scroll_reading_session_user")
  @@index([bookId], map: "idx_scroll_reading_session_book")
}

model ScrollAnnotation {
  id                String                @id @default(uuid())
  readingSessionId  String                @map("reading_session_id")
  chapterId         String                @map("chapter_id")
  text              String
  note              String
  startOffset       Int                   @map("start_offset")
  endOffset         Int                   @map("end_offset")
  createdAt         DateTime              @default(now()) @map("created_at")
  
  // Relationships
  readingSession    ScrollReadingSession  @relation(fields: [readingSessionId], references: [id], onDelete: Cascade)
  chapter           ScrollChapter         @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model ScrollBookmark {
  id                String                @id @default(uuid())
  readingSessionId  String                @map("reading_session_id")
  title             String
  chapterId         String                @map("chapter_id")
  scrollPosition    Int                   @map("scroll_position")
  percentage        Float
  createdAt         DateTime              @default(now()) @map("created_at")
  
  // Relationships
  readingSession    ScrollReadingSession  @relation(fields: [readingSessionId], references: [id], onDelete: Cascade)
}

model ScrollAudioNarration {
  id          String        @id @default(uuid())
  chapterId   String        @map("chapter_id")
  audioUrl    String        @map("audio_url")
  duration    Int           // seconds
  transcript  String
  createdAt   DateTime      @default(now()) @map("created_at")
  
  // Relationships
  chapter     ScrollChapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model ScrollAnimation {
  id        String        @id @default(uuid())
  conceptId String        @map("concept_id")
  type      AnimationType
  content   String        // JSON or URL
  duration  Int           // seconds
  createdAt DateTime      @default(now()) @map("created_at")
}

model ScrollExportRequest {
  id          String        @id @default(uuid())
  bookId      String        @map("book_id")
  userId      String        @map("user_id")
  format      ExportFormat
  options     Json?         // ExportOptions as JSON
  status      ExportStatus  @default(PENDING)
  downloadUrl String?       @map("download_url")
  fileSize    BigInt?       @map("file_size")
  error       String?
  createdAt   DateTime      @default(now()) @map("created_at")
  completedAt DateTime?     @map("completed_at")
  
  // Relationships
  book        ScrollBook    @relation(fields: [bookId], references: [id], onDelete: Cascade)
  
  @@index([userId], map: "idx_scroll_export_request_user")
  @@index([status], map: "idx_scroll_export_request_status")
}

model ScrollAgentTask {
  id          String        @id @default(uuid())
  agentId     String        @map("agent_id")
  type        AgentTaskType
  input       Json
  output      Json?
  status      TaskStatus    @default(PENDING)
  error       String?
  createdAt   DateTime      @default(now()) @map("created_at")
  completedAt DateTime?     @map("completed_at")
  
  @@index([agentId], map: "idx_scroll_agent_task_agent")
  @@index([status], map: "idx_scroll_agent_task_status")
  @@index([type], map: "idx_scroll_agent_task_type")
}

// ScrollLibrary Enums

enum AcademicLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum DiagramType {
  MERMAID
  CHART
  ILLUSTRATION
}

enum ReferenceType {
  ACADEMIC
  BIBLICAL
  WEB
}

enum SummaryType {
  CHAPTER
  SECTION
}

enum ExerciseType {
  QUESTION
  PROBLEM
  REFLECTION
}

enum SourceType {
  ACADEMIC
  BIBLICAL
  WEB
  BOOK
}

enum RelationType {
  PREREQUISITE
  RELATED
  EXTENDS
  CONTRADICTS
}

enum ReadingItemType {
  BOOK
  ARTICLE
  VIDEO
  WEBSITE
}

enum QuestionType {
  MULTIPLE_CHOICE
  ESSAY
  SHORT_ANSWER
}

enum SearchType {
  SEMANTIC
  PROPHETIC
  KEYWORD
}

enum AnimationType {
  INTERACTIVE
  VIDEO
  SIMULATION
}

enum ExportFormat {
  PDF
  EPUB
  HTML
  PRINT_READY
}

enum ExportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum AgentTaskType {
  GENERATE_TEXTBOOK
  GENERATE_CHAPTER
  FORMAT_CONTENT
  FACT_CHECK
  VALIDATE_THEOLOGY
  CREATE_EMBEDDINGS
  BUILD_KNOWLEDGE_GRAPH
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
}



// ============================================================================
// ScrollLibrary Course Integration - Missing Models
// ============================================================================

model ScrollStudentMaterialAccess {
  id                  String               @id @default(uuid())
  studentId           String               @map("student_id")
  courseMaterialId    String               @map("course_material_id")
  accessGrantedAt     DateTime             @default(now()) @map("access_granted_at")
  lastAccessedAt      DateTime             @default(now()) @map("last_accessed_at")
  cacheInvalidatedAt  DateTime?            @map("cache_invalidated_at")
  
  // Relationships
  courseMaterial      ScrollCourseMaterial @relation(fields: [courseMaterialId], references: [id], onDelete: Cascade)
  
  @@unique([studentId, courseMaterialId], map: "unique_student_material_access")
  @@index([studentId], map: "idx_scroll_student_access_student")
  @@index([courseMaterialId], map: "idx_scroll_student_access_material")
  @@map("scroll_student_material_access")
}

model ScrollStudentProgress {
  id                    String   @id @default(uuid())
  studentId             String   @map("student_id")
  courseId              String   @map("course_id")
  materialsAccessed     String[] @map("materials_accessed")
  completionPercentage  Float    @default(0) @map("completion_percentage")
  lastAccessedAt        DateTime @default(now()) @map("last_accessed_at")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")
  
  @@unique([studentId, courseId], map: "unique_student_course_progress")
  @@index([studentId], map: "idx_scroll_student_progress_student")
  @@index([courseId], map: "idx_scroll_student_progress_course")
  @@map("scroll_student_progress")
}

model ScrollMaterialUpdateNotification {
  id                String               @id @default(uuid())
  studentId         String               @map("student_id")
  courseMaterialId  String               @map("course_material_id")
  updateType        String               @map("update_type")
  version           String
  notifiedAt        DateTime             @default(now()) @map("notified_at")
  acknowledged      Boolean              @default(false)
  acknowledgedAt    DateTime?            @map("acknowledged_at")
  
  @@index([studentId], map: "idx_scroll_update_notification_student")
  @@index([acknowledged], map: "idx_scroll_update_notification_ack")
  @@map("scroll_material_update_notifications")
}

model ScrollMaterialVersion {
  id                String               @id @default(uuid())
  courseMaterialId  String               @map("course_material_id")
  materialType      String               @map("material_type")
  version           String
  updatedAt         DateTime             @default(now()) @map("updated_at")
  
  // Relationships
  courseMaterial    ScrollCourseMaterial @relation(fields: [courseMaterialId], references: [id], onDelete: Cascade)
  
  @@index([courseMaterialId], map: "idx_scroll_material_version_material")
  @@map("scroll_material_versions")
}

model ScrollCompletionAnalytics {
  studentId             String   @map("student_id")
  courseId              String   @map("course_id")
  completionPercentage  Float    @map("completion_percentage")
  lastUpdated           DateTime @default(now()) @map("last_updated")
  
  @@id([studentId, courseId])
  @@index([studentId], map: "idx_scroll_completion_analytics_student")
  @@index([courseId], map: "idx_scroll_completion_analytics_course")
  @@map("scroll_completion_analytics")
}

model ScrollPastQuestion {
  id                String               @id @default(uuid())
  courseMaterialId  String               @map("course_material_id")
  type              QuestionType
  content           String
  options           String[]
  correctAnswer     String?              @map("correct_answer")
  explanation       String?
  createdAt         DateTime             @default(now()) @map("created_at")
  
  // Relationships
  courseMaterial    ScrollCourseMaterial @relation(fields: [courseMaterialId], references: [id], onDelete: Cascade)
  
  @@index([courseMaterialId], map: "idx_scroll_past_question_material")
  @@map("scroll_past_questions")
}
